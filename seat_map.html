<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãƒ©ã‚¤ãƒŠãƒ¼äºˆç´„ã‚·ã‚¹ãƒ†ãƒ </title>
<link rel="stylesheet" href="/static/style.css">
</head>
<body>

<header class="topbar">
  <div class="left">
    <a class="homebtn" href="/">ğŸ  ãƒ›ãƒ¼ãƒ </a>
    <a class="homebtn" href="/timetable">ğŸ•’ æ™‚åˆ»è¡¨</a>
    <a class="homebtn" href="/admin">ğŸ“‹ ç®¡ç†</a>
  </div>
  <div class="right">
    <span>ãƒ©ã‚¤ãƒŠãƒ¼ MARS ã‚·ã‚¹ãƒ†ãƒ </span>
  </div>
</header>

<main class="container">

{% if mode == "select_direction" %}
  <h1>æ–¹å‘ã‚’é¸æŠã—ã¦ãã ã•ã„</h1>
  <a class="btn" href="{{ url_for('down_list') }}">â¬‡ ä¸‹ã‚Šï¼ˆé’æ³¢ä¸­å¤® â†’ èŒ¶å¿—å†…ï¼‰</a>
  <a class="btn" href="{{ url_for('up_list') }}">â¬† ä¸Šã‚Šï¼ˆèŒ¶å¿—å†… â†’ é’æ³¢ä¸­å¤®ï¼‰</a>

{% elif mode == "select_train" %}
  <h1>{{ direction }} ã®ãƒ©ã‚¤ãƒŠãƒ¼ã‚’é¸æŠ</h1>
  {% for train in trains %}
    <p><a class="train btn" href="{{ url_for('select_car', train_id=train[0]) }}">{{ train[1] }}</a></p>
  {% endfor %}

{% elif mode == "select_car" %}
  <h1>å·è»Šã‚’é¸ã‚“ã§ãã ã•ã„</h1>
  {% for c in cars %}
    <a class="btn" href="{{ url_for('car_view', train_id=selected_train, car_number=c) }}">{{ c }}å·è»Š</a>
  {% endfor %}

{% elif mode == "car_view" %}
  <h1>{{ car_number }}å·è»Š åº§å¸­è¡¨</h1>
  <div class="grid">
    {% for row, cols in seat_map.items() %}
      <div class="row">
        {% for col, val in cols.items() %}
          <span class="seat {{ 'taken' if val == 'Ã—' else 'free' }}">{{ row }}{{ col }}{{ val }}</span>
        {% endfor %}
      </div>
    {% endfor %}
  </div>

  <section class="panel">
    <h2>äºˆç´„ï¼ã‚­ãƒ£ãƒ³ã‚»ãƒ«</h2>
    <form method="POST">
      <div class="field">
        <label>ãŠåå‰</label>
        <input type="text" name="name" placeholder="å±±ç”°å¤ªéƒ" required>
      </div>

      <div class="field">
        <label>åº§å¸­ç•ªå·</label>
        <input type="text" name="seat_number" placeholder="ä¾‹: 3A" required>
      </div>

      <div class="field">
        <label>ä¹—è»Šé§…</label>
        <select name="from_station">
          {% for s in STATIONS %}
            <option>{{ s }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="field">
        <label>é™è»Šé§…</label>
        <select name="to_station">
          {% for s in STATIONS %}
            <option>{{ s }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="actions">
        <button type="submit" name="action" value="reserve">ğŸ« äºˆç´„ã™ã‚‹</button>
        <button type="submit" name="action" value="cancel" class="danger">âŒ ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      </div>
    </form>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% for category, message in messages %}
        <p class="{{ category }}">{{ message }}</p>
      {% endfor %}
    {% endwith %}
  </section>

{% elif mode == "admin_view" %}
  <h1>å…¨åˆ—è»Š äºˆç´„ä¸€è¦§</h1>
  <p><a class="btn" href="{{ url_for('export_csv') }}">ğŸ’¾ CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a></p>

  <div class="tablewrap">
    <table>
      <tr>
        <th>åˆ—è»Š</th>
        <th>å·è»Š</th>
        <th>åº§å¸­</th>
        <th>ä¹—è»Šé§…</th>
        <th>é™è»Šé§…</th>
        <th>äºˆç´„è€…</th>
        <th>çŠ¶æ…‹</th>
      </tr>
      {% for r in reservations %}
        <tr>
          <td>{{ r[0] }}</td>
          <td>{{ r[1] }}</td>
          <td>{{ r[2] }}</td>
          <td>{{ r[4] }}</td>
          <td>{{ r[5] }}</td>
          <td>{{ r[3] }}</td>
          <td>{{ 'âœ…' if r[6]=='reserved' else 'âŒ' }}</td>
        </tr>
      {% endfor %}
    </table>
  </div>

{% endif %}

</main>

</body>
</html>
