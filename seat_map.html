<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãƒ©ã‚¤ãƒŠãƒ¼äºˆç´„ã‚·ã‚¹ãƒ†ãƒ </title>
<link rel="stylesheet" href="/static/style.css">
</head>
<body>
<h1>ğŸš„ ãƒ©ã‚¤ãƒŠãƒ¼ MARS ã‚·ã‚¹ãƒ†ãƒ </h1>

{% if mode == "select_direction" %}
  <h2>æ–¹å‘ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
  <a class="btn" href="{{ url_for('down_list') }}">â¬‡ ä¸‹ã‚Šï¼ˆé’æ³¢ä¸­å¤® â†’ èŒ¶å¿—å†…ï¼‰</a>
  <a class="btn" href="{{ url_for('up_list') }}">â¬† ä¸Šã‚Šï¼ˆèŒ¶å¿—å†… â†’ é’æ³¢ä¸­å¤®ï¼‰</a>

{% elif mode == "select_train" %}
  <h2>{{ direction }} ã®ãƒ©ã‚¤ãƒŠãƒ¼ã‚’é¸æŠ</h2>
  {% for train in trains %}
    <p><a class="train" href="{{ url_for('select_car', train_id=train[0]) }}">{{ train[1] }}</a></p>
  {% endfor %}

{% elif mode == "select_car" %}
  <h2>å·è»Šã‚’é¸æŠ</h2>
  {% for c in cars %}
    <a class="btn" href="{{ url_for('car_view', train_id=selected_train, car_number=c) }}">{{ c }}å·è»Š</a>
  {% endfor %}

{% elif mode == "car_view" %}
  <h2>{{ car_number }}å·è»Š åº§å¸­è¡¨</h2>
  <div class="grid">
    {% for row, cols in seat_map.items() %}
      <div class="row">
        {% for col, val in cols.items() %}
          <span class="seat {{ 'taken' if val == 'Ã—' else 'free' }}">{{ row }}{{ col }}{{ val }}</span>
        {% endfor %}
      </div>
    {% endfor %}
  </div>
  <form method="POST">
    <h3>äºˆç´„ï¼ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ“ä½œ</h3>
    <input type="text" name="name" placeholder="ãŠåå‰" required>
    <input type="text" name="seat_number" placeholder="åº§å¸­ä¾‹: 3A" required>
    <select name="from_station">
      {% for s in STATIONS %}<option>{{ s }}</option>{% endfor %}
    </select>
    <select name="to_station">
      {% for s in STATIONS %}<option>{{ s }}</option>{% endfor %}
    </select>
    <button type="submit" name="action" value="reserve">äºˆç´„</button>
    <button type="submit" name="action" value="cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
  </form>
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% for category, message in messages %}
      <p class="{{ category }}">{{ message }}</p>
    {% endfor %}
  {% endwith %}

{% elif mode == "admin_view" %}
  <h2>ğŸš‰ å…¨åˆ—è»Šäºˆç´„ä¸€è¦§</h2>
  <p><a class="btn" href="{{ url_for('export_csv') }}">ğŸ’¾ CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a></p>
  <table>
    <tr><th>åˆ—è»Š</th><th>å·è»Š</th><th>åº§å¸­</th><th>ä¹—è»Šé§…</th><th>é™è»Šé§…</th><th>äºˆç´„è€…</th><th>çŠ¶æ…‹</th></tr>
    {% for r in reservations %}
      <tr>
        <td>{{ r[0] }}</td><td>{{ r[1] }}</td><td>{{ r[2] }}</td><td>{{ r[4] }}</td><td>{{ r[5] }}</td><td>{{ r[3] }}</td>
        <td>{{ 'âœ…' if r[6]=='reserved' else 'âŒ' }}</td>
      </tr>
    {% endfor %}
  </table>
{% endif %}

</body>
</html>
